---
layout: post
title:  "Bulkhead 격벽 패턴"
date:   2019-12-22 13:04:00
author: bghgu
categories: pattern
tags: [pattern, bulkhead]
---

#### Bulkhead 격벽 패턴
* 격벽 패턴의 목표는 시스템의 한 부분에서 오류가 발생하지 않도록하여 전체 시스템을 중단시키는 것이다.
* 이 용어는 선박 전체가 범람하는 단일 선체 위반을 피하기 위해 선박이 별도의 방수 구획으로 나뉘어 진 선박에서 나온다.
* 단 하나의 격벽만 침수된다.
* 격벽 패턴의 구현은 시스템을 보호하려는 결함의 종류에 따라 여러 가지 형태를 취할 수 있다.

#### Spring Hystrix의 격벽 패턴
* Hystrix의 격벽 패턴 구현은 구성 요서에 대한 동시 호출 수를 제한한다.
* 이러한 방식으로 구성 요소의 응답을 기다리는 리소스(일반적으로 스레드)의 수가 제한된다.
* A, B 및 C의 세 가지 구성 요소를 사용하는 요청 기반 다중 스레드 응용 프로그램(일반 웹 응용 프로그램)이 있다고 가정합니다.
* 컴포넌트 C에 대한 요청이 정지되기 시작하면 결국 모든 요청 처리 스레드는 C의 응답을 기다리는 동안 정지된다.
* 이로 인해 응용 프로그램이 완전히 응답하지 않게 된다.
* C 요청이 느리게 처리되면 부하가 충분히 높으면 비슷한 문제가 발생한다.
* 격벽 패턴의 Hystrix의 구현은 구성 요소에 대한 동시 호출 수를 제한하며 이 경우 애플리케이션을 저장했을 것이다.
* 요청 처리 스레드가 30개이고 C에 대한 동시 호출이 10개로 제한되어 있다고 가정한다.
* 그런 다음 C를 호출 할 때 최대 10개의 요청 처리 스레드가 중단 될 수 있지만 나머지 20개의 스레드는 여전히 요청을 처리하고 구성 요소 A, B를 사용할 수 있다.

#### Hystrix의 접근법
* Hystrix는 격벽에 대한 두 가지 접근 방식, 스레드 격리 및 세마포어 격리가 있다.
* 스레드 격리
    * 표준 접근 방식은 컴포넌트 C에 대한 모든 요청을 고정 된 수의 스레드가 있는 (또는 작은) 요청 큐가 있는 별도의 스레드 풀로 전달하는 것이다.
* 세마포어 격리
    * 다른 접근 방식은 모든 호출자가 C에 요청하기 전에 허용 시간(0 시간 초과)을 갖도록 하는 것이다.
    * 세마포어에서 허가를 취득할 수 없으면 C에 대한 호출은 통과되지 않는다.
* 차이점
    * 스레드 풀 접근 방식의 장점은 C로 전달 된 요청이 시간 초과 될 수 있다는 것이다.
    * 이는 세마포어를 사용할 때는 불가능하다.

* https://stackoverflow.com/questions/30391809/what-is-bulkhead-pattern-used-by-hystrix