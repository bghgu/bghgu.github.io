---
layout: post
title:  "Transaction(트랜잭션)"
date:   2020-01-14 19:55:00
author: bghgu
categories: Database
tags: [Database]
---

#### Transaction 트랜잭션
* 데이터베이스 관리 시스템에서 상호 작용의 단위이다.
* 트랜잭션은 ACID를 보장해야 한다.

#### ACID
* Atomicity 원자성 : 한 트랜잭션 내에서 실행한 작업들은 하나의 작업으로 간주한다. 모두 성공하거나 모두 실패되어야 한다.
* Consistency 일관성 : 모든 트랜잭션은 일관성있는 데이터베이스 상태를 유지한다. DB에서 정한 무결성 원칙을 항상 만족한다.
* Isolation 독립성 : 동시에 실행되는 트랜잭션들이 서로 영향을 미치지 않도록 격리해야 한다.
* Durability 지속성 : 트랜잭션을 성공적으로 마치면 그 결과가 항상 저장되어야 한다.

#### 격리성 관련 문제점
* 격리성을 완벽히 보장하기 위해 모든 트랜잭션을 순차적으로 실행한다면 동시성 처리 이슈가 발생하게 된다.
* 동시성을 높이기 위해 여러 트랜잭션을 병렬 처리 방식으로 처리하게 되면 데이터의 무결성이 깨질 수 있다.

#### Dirty Read
* 커밋되지 않은 수정 중인 데이터를 다른 트랜잭션에서 읽을 수 있도록 허용할 때 발생하는 현상이다.
* 어떤 트랜잭션에서 아직 실행이 끝나지 않은 다른 트랜잭션에 의해 변경 사항을 보게 되는 경우이다.

#### Non-Repeatable Read
* 한 트랜잭션에서 같은 SQL을 두 번 수행할 때, 두 SQL의 결과가 다르게 나타나는 비 일관적인 현상이다.
* 한 트랜잭션이 수행중일 때 다른 트랜잭션이 값을 수정, 삭제함으로써 나타난다.

#### Phantom Read
* 한 트랜잭션에 같은 SQL을 두 번 수행할 때, 첫 번째 SQL에서 없던 데이터가 두 번째 SQL에서는 나타나는 현상이다.
* 한 트랜잭션이 수행중일 때 다른 트랜잭션이 해당 테이블에 값을 삽입함으로써 나타난다.

----

#### Transaction Isolation Level 트랜잭션 격리 레벨
* 트랜잭션에서 일관성이 없는 데이터를 어느 정도까지 허용하는지에 대한 수준이다.
* 데이터베이스는 ACID 같이 트랜잭션이 원자적이면서도 독립적인 수행을 하도록 한다.
* 4단계의 격리 수준을 나누었다.
* 단계를 내려갈수록 격리 수준이 높아져서 언급된 이슈는 적게 발생하지만, 동시 처리 성능은 떨어진다.
* 응답성을 높이기 위해 단계를 올라간다면, 잘못된 값이 처리 될 여지가 있다.
* 트랜잭션이 발생하면 락이 걸리는데 select시에는 공유 락, create/insert/deletet 시에는 배타적 락이 걸린다.

#### Read Uncommitted 레벨 0
* select가 수행되는 동안 해당 데이터에 공유 락이 걸리지 않는다.
* 트랜잭션이 처리중인 혹은 아직 커밋되지 않은 데이터를 다른 트랜잭션이 읽는 것을 허용한다.
* 어떤 사용자가 A라는 데이터를 B라는 데이터로 변경하는 동안 다른 사용자는 아직 완료되지 않은(Uncommitted 혹은 Dirty) 트랜잭션이지만 변경된 데이터인 B를 읽을 수 있다.
* 데이터베이스의 일관성을 유지할 수 없다.
* Drity Read, Non-Repeatable, Phantom Read 발생

#### Read Committed 레벨 1
* select가 수행되는 동안 해당 데이터에 공유 락이 걸린다.
* 트랜잭션이 수행되는 동안 다른 트랜잭션이 접근할 수 없어 대기하게 된다.
* 커밋이 아루어진 트랜잭션만 조회할 수 있다.
* 어떤 사용자가 A라는 데이터를 B라는 데이터로 변경하는 동안 다른 사용자는 해당 데이터에 접근할 수 없다.
* SQL Server가 기본으로 사용하는 단계이다.
* Non-Repeatable, Phantom Read 발생

#### Repeatable Read 레벨 2
* 트랜잭션이 완료될 때가지 select가 사용하는 모든 데이터에 공유 락이 걸린다.
* 트랜잭션이 범위 내에서 조회한 데이터의 내용이 항상 동일함을 보장한다.
* 다른 사용자는 그 영역에 해당되는 데이터에 대한 **수정**이 불가능하다.
* Phantom Read 발생

#### Serializable 레벨 3
* 트랜잭션이 완료될 때까지 select가 사용하는 모든 데이터에 공유 락이 걸린다.
* 완벽한 읽기 일관성 모드를 제공한다.
* 가장 엄격한 격리 수준이다.
* 다른 사용자는 그 영역에 해당되는 데이터에 대한 **수정 및 입력**이 불가능하다.
* 모든 문제점을 커버 가능하다.
* 동시 처리 성능은 급격히 떨어질 수 있다.